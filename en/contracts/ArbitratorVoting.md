# ArbitratorVoting contract

## Общие Утверждения

* Кол-во `uint256` топ-кандидатов для пуша в мультисиг управляется ролью GALT_SPACE
* В любой момент любой адрес может выполнить метод, который пушит текущий топ-список валидаторов из контракта голосования в сам мультисиг
* Голосовать имеют право либо владельцы SPACE токенов либо Оракулы.
* 100% голосов состоит из
    * 50% - равны 100% голосам всех участков Space токенов
    * 50% - равны 100% голосам держателей всех стейков
* Веса голосов
    * Вес голоса адреса-владельца SPACE токена определяется площадью всех заложенных им участком на конкретном мультисиге
    * Вес голоса оракула определяется размером заложенного им стейком. Если баланс стейка в минусе - это так же учитываются (суммируется).
    * Если адрес является и оракулом и владельцем SPACE токена, он может (но не принуждается) использовать обе роли при голосовании.

## Источники данных
### Голосование Space owner
* Владельцы SPACE токенов для голосования блокируют свой SPACE токен к конкретному мультисигу.
    * Возможность передачи токена блокируется
    * Чтобы передать SPACE токен, необходимо сначала его разблокировать.
    * Разные SPACE токены можно лочить на разные мультисиги даже если у них один владелец
* Контракт SpaceReputationAccounting ведет учет (получает коллбеки от 721 контракта) и служит источником информации:
    * totalSpace (over all multisigs)
    * totalStakedSpace (over all multisigs)
    * (multisig => totalStakedSpace)
    * (multisig => (owner => totalStakedSpace))
* Текущий вес голоса на момент голосования рассчитывается как (owner stake at given multisig / total multisig stakes).
* Total multisig stakes суммирует только те участки, владельцы которых явно сделали стейк на этот мультисиг. Участки, у которых не назначены мультисиги не учитываются.

Пример `SpaceReputationAccounting`

````solidity
contract SpaceReputationAccounting {
    uint256 totalSpace;
    uint256 totalStakedSpace;

    // SpaceOwner => totalStakedSpace
    mapping(address => uint256) ownerStakedSpace;
    mapping(address => mapping(address => uint256)) ownerTotalStakedSpacePerSpaceToken;
    
    function getWeightFor(address _for) public returns (uint256);
}
````

### Голосование оракула
* Оракул уже работает в рамках одного из мультисигов, поэтому его голоса не требуют отдельной привязки
* Контракт OraclesMultisigAccounting ведет учет и служит источником информации:
    * Залогов каждого оракла в разрезе (multisig=>(oracle=>totalStakes))
    * Залогов всех оракулов по конкретному мультисигу (multisig=>totalStakes)

## Интеграция с существующими контрактами
### SpaceToken
`SpaceToken` перед выполнением нижеперечисленных действий вызывает SpaceReputationAccounting, который выполняет внутренние проверки в своем реестре и, при необходимости, вызывает отмену транзакции (в случае, если токен застейкан). Список действий 721 токена:
* setApprovalForAll()
* approve()
* transferFrom()
* safeTransferFrom()
* burn()

## Questions

* Все ли готовы голосовать публично?

