# Controller

## Описание проблемы
- Между контрактами локального Фонда(Multisig, Reputation, Voting) необходимо обеспечить связи, чтобы один контракт имел право изменять данные в другом контракте.
- Между глобальными контрактами(SpaceToken, DaoRegistry, Auction, GlobalReputation) также необходимо обеспечить связи, чтобы один из контрактов мог вносить изменения в другой контракт посредством Controller.
- Необходимо предоставить возможность пользователям выполнять функции, которые влияют на множество контрактов сразу(Например освобождение от SpaceToken).

## Цели контракта
- Добиться безопасного взаимодействия и влияния одних контрактов на другие.
- Обеспечить получение необходимой информации из одного контракта о другом.
- Инкапсулировать общую логику взаимодействия контрактов внутри локальных DAO.
- Обозначить логику воздействия локального Фонда на DaoRegistry.
- По аналогии с DaoStack[1] делегировать выполнение большого количества функций от имени Multisig.
- Обеспечить возможность миграции на новую версию функционала путем замены контроллера у Multisig по аналогии с DaoStack[1].

## Функции контракта

### Разрешить аукциону распоряжаться землей Фонда
- Функция approveAuction
- Вызывается при инициализации
- Отправляет Multisig контракту запрос на предоставление разрешения контракту Auction отправлять при продаже SPACE токены с адреса Multisig на адрес покупателя.

### Создать и отправить на аукцион SPACE токен
- Функция createSpace
- Вызывается при SpaceGenesis и по решению делегатов
- Выполняет mint нового SPACE токена
- Сообщает DaoRegistry о создании нового SPACE токена
- Создает лот SPACE токена на контракте Auction

### Обработать перемещение репутации вместе со SPACE токеном между пользователями
- Функция handleTransferReputationWithinDao
- Вызывается из контракта DaoRegistry при вызове transferFrom в SpaceToken
- Также может вызываться при продаже SPACE токена на аукционе с передачей цены продажи для записи цены как залоченных GALT за SPACE токеном
- Вызывает функции в контрактах локальной и глобальной репутации для внесения изменений в репутацию

### Обработать вывод репутации пользователя вместе со SPACE токеном из текущего локального Фонда в другой
- Функция handleWithdrawReputation
- Вызывается из DaoRegistry при трансфере SPACE токена между Фондами
- Вызывает функцию у контракта Reputation для вывода репутации токена с Фонда
- Перемещает GALT из текущего Фонда в новый
- Вызывает у Voting функцию перерасчета голосов

### Обработать добавление репутации пользователю вместе со SPACE токеном из исходного Фонда в текущий Фонд
- Функция handleInsertReputation
- Вызывается из DaoRegistry при трансфере SPACE токена между Фондами
- Вызывает функцию у контракта Reputation для добавления репутации токена в Фонда
- Перемещает пропорциональное количество ETH количеству GALT из исходного Фонда в текущий
- Вызывает у Voting функцию перерасчета голосов

### Дать пользователям возможность отказаться от земли(SPACE токена) и получить из Фонда залоченные за землей GALT токены
- Функция release
- Вызывается владельцем SPACE токена
- Выполняет transfer SPACE токена от пользователя в Фонд
- Выполняет transfer GALT токенов из Фонда пользователю
- Отправляет SPACE токена на аукцион

### Дать пользователям возможность отказаться от GALT и получить из Фонда пропорциональное количество ETH
- Функция exit
- Вызывается владельцем GALT токенов
- Выполняет transfer GALT токенов от пользователя к Фонду
- Выполняет transfer ETH от Фонда к пользователю

### Разбить земельный участок на множество дочерних
- Функция splitSpace
- Вызывается владельцем SPACE токена
- Разбивает участки с помощью Space контракта и сообщает DAoRegistry об обновлении

### Обьеденить множество дочерних участков в родительский
- Функция mergeSpace
- Вызывается владельцем SPACE токенаов
- Обьеденяет участки с помощью Space контракта и сообщает DAoRegistry об обновлении


## Референсы
1. [DaoStack контракты контроллера](https://github.com/daostack/arc/tree/master/contracts/controller)