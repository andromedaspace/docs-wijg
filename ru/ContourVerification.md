# Contour Verification

## Проблема
Необходимо не допустить существование участков с пересекающимися контурами.

## Реализация
### Контракты
#### Контракт ContourModificationManager
Создаем контракт ContourModificationManager, где у нас будет очередь из заявок двух типов
* Добавить контур
* Удалить контур

В этом контракте валидаторы контуров голосуют за заявки. Сами заявки доступны для обработки только в порядке очереди, следующая заявка из очереди будет доступна только после того, как примется решение по текущей.


##### Заявка на добавление контура

* Заявитель подает заявку на аппрув контура валидаторами контуров после создания заявки в NewPropertyManager, но перед тем, как ораклы из NewPropertyManager начали работать над ней
* Из SplitMerge контракта можно подать заявку на аппрув создания новых контуров, следующий шаг SplitMerge просесса возможен только после добавления контуров в соответствующем реестре

##### Заявка на удаление контура

* Если владелец предыдущего контура сжег его и хочет заминтить контур с пересекающейся площадью, он мотивирован подать заявку на удаление текущего контура
* Если предыдущий владелец контура не сжег его, новый владелец замотивирован сам подать заявку на сжигание контура
* Из SplitMerge контракта можно подать заявку на аппрув удаления старых контуров, следующий шаг SplitMerge процесса возможен только после удаления старых контуров в соответствующем реестре

#### Контракт ContourModificationApprovalRegistry
Создаем контракт ContourModificationApprovalRegistry, где учитываем одобренные валидаторами контуров изменения
* права на изменения mapping-ов `approvedAdditions`/`approvedRemovals` находятся у контракта ContourModificationManager
* срок годности одобренных заявок составляет 30 дней (в каждой проставляется timestamp устаревания аппрува)

#### Контракт ChangeContourController
Создаем контракт ChangeContourController
* только этот контракт имеет право на изменение контура в SpaceGeoDataRegisty
* в добавок к самому контуру для изменения, ему необходимо передать id одобренного изменения из ContourModificationApprovalRegistry.
* право вызова метода #setSpaceTokenContour() принадлежит ACL роли GEO_DATA_MANAGER

Можно рассматривать этот контракт как обертка над методом SpaceGeoDataRegistry.setSpaceTokenContour(), которая удостоверяется в том, что изменение было одобрено
