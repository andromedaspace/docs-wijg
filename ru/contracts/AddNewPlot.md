# Контракт PlotManager - Документация

## Описание проблемы
Необходимо дать возможность любому Человеку, который владеет Землей - добавить свой `Земельный участок` в проект бесплатно. При этом форма участка может быть произвольной.

## Цель Контракта
- Дать возможность любому человеку вступить в `Проект` с нулевой `Репутацией` для построения глобального Сообщества.
- Дать возможность учитывать участки произвольной формы.

## Общие условия
Действия будет выполнять сервис. Вдалельцем Контракта PlotManager будет GALT Project Core Team. В Контракте будет храниться ХЕШ Фамилии, Имени, ID / Паспорта Владельца, а так же Кадастровый номер участка в той или иной правовой Юрисдикции. 
Контракт PlotManager будет иметь права на операции над контрактом SPACE - токен, пока система будет тестироваться. Потом эти права будут убраны! В случае ошибок GALT Project Core Team или третьи лица по ее поручению будут исправлять возникшие ошибки.

## Сценарий Контракта

1. Пользователь через веб-интерфейс, подключенный к MetaMask вводит следующие параметры:

|Параметр|Значение|
|--------|--------|
|3-N точек границ Земельного участка в формате Геохеш - координат|[w24qgy48e](http://explorer.galtproject.io/map/#w24qgy48e), [w24qgsqw3](http://explorer.galtproject.io/map/#w24qgsqw3), [w24qgumbk](http://explorer.galtproject.io/map/#w24qgumbk)|
|Фамилия и Имя| Свою Фамилию и Имя|
|Номер ID / Паспорта|5478467392|
|Кадастровый номер участка в своей юрисдикции|630107140031259|
|Точность разбиения|11|

Сервис не хранит Фамилия и Имя и Номер ID / Паспорта!

Сервис определяет разбиение этого участа на Геохеши с заданной точностью апроксимации в браузере и строит картинку.

Например:

|Геохеш|
|------|
|[w24qguf](http://explorer.galtproject.io/map/#w24qguf)|
|[w24qguc](http://explorer.galtproject.io/map/#w24qguc)|
|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|
|Другие 36 Геохешей|

Всего 39 геохешей.

2. Пользователь подписывает транзакцию на создание заявки. 

Вызывается метод. Создается новый SPACE - токен SPACE `Упаковки`. 

|Токен|Владелец|
|-----|--------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|Контракт SplitMerge |

В контракте SplitMerge добавляется запись в маппинг CustomPlotBorders, который содержит соответствие id уникального участка - координата вершины. Подробнее - Контракт [SplitMerge](https://github.com/andromedaspace/galtproject-docs/blob/master/ru/contracts/SplitMerge.md#%D0%A1%D1%86%D0%B5%D0%BD%D0%B0%D1%80%D0%B8%D0%B9-3-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D1%83%D0%BD%D0%B8%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D1%83%D1%87%D0%B0%D1%81%D1%82%D0%BA%D0%BE%D0%B2).

|Токен SPACE|номер позиции|координата вершины|
|-----|--------| --------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|1|[w24qgy48e](http://explorer.galtproject.io/map/#w24qgy48e) |
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|2|[w24qgsqw3](http://explorer.galtproject.io/map/#w24qgsqw3) |
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|3|[w24qgumbk](http://explorer.galtproject.io/map/#w24qgumbk) |

Создаются токен SPACE самого большого геохеша, который входит в Земельный участок. Владец токенов - PlotManager.

|Токен SPACE|Владелец|
|-----|--------|
|[w24qguf](http://explorer.galtproject.io/map/#w24qguf)|Контракт PlotManager|

Происходить запись в маппинг <id токена SPACE `Упаковки`> - <id токена SPACE `Геохеш - участка`>. Это фактически правила сборки или соответствие уникального участка - геохешам.

|id токена SPACE `Упаковки`|номер позиции|id токена SPACE `Геохеш-участка`|
|------------------|------------|-------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|1|[w24qguf](http://explorer.galtproject.io/map/#w24qguf)|

Происходит запись в мапинг <id токена SPACE `Геохеш - участка`> - <id токена SPACE `Упаковки`>

|id токена SPACE `Геохеш-участка`|номер позиции| id токена SPACE `Упаковки`|
|------------------|------------|-------|
|[w24qguf](http://explorer.galtproject.io/map/#w24qguf) |0|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|

Методами SplitMerge - токен [w24qguf](http://explorer.galtproject.io/map/#w24qguf) упаковывается в 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk через обмен. 

|Токен SPACE|Владелец|
|-----|--------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|Контракт PlotManager |
|[w24qguf](http://explorer.galtproject.io/map/#w24qguf)|Контракт PlotManager |

И в итоге Владелец токена 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk - контракт PlotManager. Создан и передан контракту SplitMerge токен [w24qguf](http://explorer.galtproject.io/map/#w24qguf).

Создается Заявка:

|Параметр|Значение|
|--------|--------|
|id Заявки|DBn4y2a......35b1|
|Ethereum адрес заявителя| 0xFB7442a......69e3|
|Точки Границ участка массивом|[w24qgy48e](http://explorer.galtproject.io/map/#w24qgy48e), [w24qgsqw3](http://explorer.galtproject.io/map/#w24qgsqw3), [w24qgumbk](http://explorer.galtproject.io/map/#w24qgumbk)|
|Хеш ИМЕНИ ФАМИЛИИ Номер ID / Паспорта|70931C7045A38EA193822F8E4AFF8188128DAA2624AE9FA30BFE025DA5059C03|
|Кадастровый номер участка в своей юрисдикции|630107140031259|
|id `Упаковки`|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|
|Статус заявки|Создана|
|Нотариус Заявки|0x08d32...........9d791e6|
|Страна|Код страны|

Заявка записывается в Контракт.

Пользователь в Сервисе нажимает кнопку "Добавить все геохеши". Сервис создает серию транзакций. В каждой транзакции указывается - ID заявки и массив геохешей.

Пользователь подписывает транзакцию.

Метод контракта PlotManager создает для всех переданных геохешей токен SPACE `Геохеш - участка.`

|Токен SPACE|Владелец|
|-----|--------|
|[w24qguc](http://explorer.galtproject.io/map/#w24qguc)|Контракт PlotManager|
|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|Контракт PlotManager|
| Еще 36 токенов|Контракт PlotManager|

Метод по ID заявки берет ID SPACE `Упаковки` 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk и методом контракта SplitMerge производит запись в маппинги SplitMerge и передает токены контракту SplitMerge.

|id токена SPACE `Упаковки`|номер позиции|id токена SPACE `Геохеш-участка`|
|------------------|------------|-------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|2|[w24qguc](http://explorer.galtproject.io/map/#w24qguc)|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|3|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|4-39|39 токенов SPACE |

|id токена SPACE `Геохеш-участка`|номер позиции| id токена SPACE `Упаковки`|
|------------------|------------|-------|
|[w24qguc](http://explorer.galtproject.io/map/#w24qguf) |0|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|
|[w24qgv4](http://explorer.galtproject.io/map/#w24qguf) |0|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|
|39 токенов SPACE |0|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|


|Токен SPACE|Владелец|
|-----|--------|
|[w24qguc](http://explorer.galtproject.io/map/#w24qguc)|Контракт SplitMerge|
|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|Контракт SplitMerge|
| Еще 36 токенов|Контракт SplitMerge|

В итоге все 39 токенов SPACE принадлаежат контракту SplitMerge, а токен 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk контракту PlotManager.

3. Пользователь нажимает кнопку "Отправить заявку". Сервис создает транзакцию, пользователь оплачивает газ и 1 Эфир контракту.

|Параметр|Значение|
|--------|--------|
|id Заявки|DBn4y2a......35b1|
|Статус заявки|На рассмотрении|

4. В контракте есть маппинг адресов, которые имеют право утверждать Заявки. Маппинг записывается Владельцем контракта - GALT PROJECT CORE TEAM. Фактически это список адресов, которые могут создавать транзакцию с кадастровым номером, Фамилией и Именем для проверки. Назовем эти Адреса - `Нотариус Заявки`.

5. `Нотариус Заявки` через веб интерфейс и подключенный metamask видит свои текущие Заявки. Он заходит в заявку. По кадастровому номеру находит в Кадастре той или иной страны Фамилию и Имя заявителя, его ID. Вводит точки Границ участка по Кадастру, Фамилию и Имя, Номер ID / Паспорта. Проверяет, что границы Участка совпадают и Геохеши не выходят за границы земельного участка. 

6. Нотариус Подписывает транзакцию. Вычисляется ХЕШ Фамилии и Имени, Номер ID / Паспорта. Происходит сравнение ХЕШЕЙ и координат вершин участка. Если все ок - статус заявки меняется на выполнен.

|Параметр|Значение|
|--------|--------|
|id Заявки|DBn4y2a......35b1|
|Статус заявки|Выполнена|

6. Токен 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk передается пользователю.

|Токен SPACE|Владелец|
|-----|--------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|Заявитель 0xFB7442a......69e3 |

7. `Нотариус заявки` получает 1 ETH.

Далле - контракт [CreateTerritory](CreateTerritory.md)
