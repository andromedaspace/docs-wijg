# Контракт AddNewPlot - Документация

## Описание проблемы
Необходимо дать возможность любому Человеку, который владеет Землей - добавить свой `Земельный участок` в проект бесплатно. При этом форма участка может быть произвольной.

## Цель Контракта
- Дать возможность любому человеку вступить в `Проект` с нулевой `Репутацией` для построения глобального Сообщества.
- Дать возможность учитывать участки произвольной формы.

## Общие условия
Действия будет выполнять сервис. Вдалельцем Контракта AddNewPlot будет GALT Project Core Team. В Контракте будет храниться ХЕШ Фамилии, Имени, ID / Паспорта Владельца, а так же Кадастровый номер участка в той или иной правовой Юрисдикции. 
Контрак AddNewPlot будет иметь права на операции над контрактом SPACE - токен, пока система будет тестироваться. Потом эти права будут убраны! В случае ошибок GALT Project Core Team или третьи лица по ее поручению будут исправлять возникшие ошибки.

## Сценарий Контракта

1. Пользователь через веб-интерфейс, подключенный к MetaMask вводит следующие параметры:

|Параметр|Значение|
|--------|--------|
|3-N точек границ Земельного участка в формате Геохеш - координат|[w24qgy48e](http://explorer.galtproject.io/map/#w24qgy48e), [w24qgsqw3](http://explorer.galtproject.io/map/#w24qgsqw3), [w24qgumbk](http://explorer.galtproject.io/map/#w24qgumbk)|
|Фамилия и Имя| Свою Фамилию и Имя|
|Номер ID / Паспорта|5478467392|
|Кадастровый номер участка в своей юрисдикции|630107140031259|

Сервис не хранит Фамилия и Имя и Номер ID / Паспорта!

Сервис определяет разбиение этого участа на Геохеши с заданной точностью апроксимации. 

Например:

|Геохеш|
|------|
|[w24qguf](http://explorer.galtproject.io/map/#w24qguf)|
|[w24qguc](http://explorer.galtproject.io/map/#w24qguc)|
|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|
|Другие 36 Геохешей|

И записывает самый большой Геохеш в заявку, например, [w24qgv4](http://explorer.galtproject.io/map/#w24qgv4).

Сервис определяет Адрес Нотариуса Заявки и записывает его в заявку.

2. Пользователь подписывает транзакцию. 

Вызывается метод. Создается новый SPACE - токен, который соответствует Уникальному Земельному участку. 

|Токен|Владелец|
|-----|--------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|Контракт SplitMerge |

В контракте SplitMerge добавляется запись в маппинг CustomPlotBorders, который содержит соответствие id уникального участка - координата вершины. Подробнее - Контракт [SplitMerge](https://github.com/andromedaspace/galtproject-docs/blob/master/ru/contracts/SplitMerge.md#%D0%A1%D1%86%D0%B5%D0%BD%D0%B0%D1%80%D0%B8%D0%B9-3-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D1%83%D0%BD%D0%B8%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D1%83%D1%87%D0%B0%D1%81%D1%82%D0%BA%D0%BE%D0%B2).

|Токен SPACE|номер позиции|координата вершины|
|-----|--------| --------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|1|[w24qgy48e](http://explorer.galtproject.io/map/#w24qgy48e) |
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|2|[w24qgsqw3](http://explorer.galtproject.io/map/#w24qgsqw3) |
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|3|[w24qgumbk](http://explorer.galtproject.io/map/#w24qgumbk) |

Создаются токены на каждый геохеш, который входит в Земельный участок. Владец токенов - AddNewPlot.

|Токен SPACE|Владелец|
|-----|--------|
|[w24qguf](http://explorer.galtproject.io/map/#w24qguf)|Контракт AddNewPlot|
|[w24qguc](http://explorer.galtproject.io/map/#w24qguc)|Контракт AddNewPlot|
|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|Контракт AddNewPlot|
|Другие 36 Токенов|Контракт AddNewPlot|

Происходить запись в маппинг <id токена SPACE произвольного участка> - <id токена SPACE Стандартного участка - геохеша>. Это фактически правила сборки или соответствие уникального участка - геохешам.

|id токена SPACE `Упаковки`|номер позиции|id токена SPACE `Геохеш-участка`|
|------------------|------------|-------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|1|[w24qguf](http://explorer.galtproject.io/map/#w24qguf)|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|2|[w24qguc](http://explorer.galtproject.io/map/#w24qguc)|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|3|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|

Дальше пользователь методами SplitMerge - "упаковывает" токены отдельных Геохешей в свой уникальный участок. Происходит обмен между Контрактом SplitMerge и AddNewPlot. 

|Токен SPACE|Владелец|
|-----|--------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|Контракт AddNewPlot |
|[w24qguf](http://explorer.galtproject.io/map/#w24qguf)|Контракт SplitMerge|
|[w24qguc](http://explorer.galtproject.io/map/#w24qguc)|Контракт SplitMerge|
|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|Контракт SplitMerge|
|Другие 36 Токенов|Контракт SplitMerge|

И в итоге Владелец токена 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk - контракт AddNewPlot. Созданы и переданы контракту SplitMerge все SPACE - токены Геохешей и записано из каких геохешей состоит 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk.

Вызывается метод контракта AddNewPlot по созданию новой заявки.

Заявка содержит:

|Параметр|Значение|
|--------|--------|
|id Заявки|DBn4y2a......35b1|
|Ethereum адрес заявителя| 0xFB7442a......69e3|
|Точки Границ участка массивом|[w24qgy48e](http://explorer.galtproject.io/map/#w24qgy48e), [w24qgsqw3](http://explorer.galtproject.io/map/#w24qgsqw3), [w24qgumbk](http://explorer.galtproject.io/map/#w24qgumbk)|
|Хеш Фамилии и Имени|70931C7045A38EA193822F8E4AFF8188128DAA2624AE9FA30BFE025DA5059C03|
|Хеш Номер ID / Паспорта|D7621401F35048A00C1D294EA4C78D3FB226350BE4A903F87AA1BCEC3C5DFBFB|
|Кадастровый номер участка в своей юрисдикции|630107140031259|
|Главный Геохеш, входящий в новый участок|[w24qgv4](http://explorer.galtproject.io/map/#w24qgv4)|
|id Токена участка|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|
|Статус заявки|Создана|
|Нотариус Заявки|0x08d32...........9d791e6|
|Страна|Код страны|

Заявка записывается в Контракт.


3. В контракте есть маппинг адресов, которые имеют право утверждать Заявки. Маппинг записывается Владельцем контракта - GALT PROJECT CORE TEAM. Фактически это список адресов, которые могут создавать транзакцию с кадастровым номером, Фамилией и Именем для проверки. Назовем эти Адреса - `Нотариус Заявки`.

4. `Нотариус Заявки` через веб интерфейс и подключенный metamask видит свои текущие Заявки. Он заходит в заявку. По кадастровому номеру находит в Кадастре той или иной страны Фамилию и Имя заявителя, его ID. Вводит точки Границ участка по Кадастру, Фамилию и Имя, Номер ID / Паспорта. Проверяет, что границы Участка совпадают и Геохеши не выходят за границы земельного участка. 

5. Нотариус Подписывает транзакцию. Вычисляется ХЕШ Фамилии и Имени, Номер ID / Паспорта. Происходит сравнение ХЕШЕЙ и координат вершин участка. Если все ок - статус заявки меняется на выполнен.

|Параметр|Значение|
|--------|--------|
|id Заявки|DBn4y2a......35b1|
|Статус заявки|Выполнена|

6. Токен 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk передается пользователю.

|Токен SPACE|Владелец|
|-----|--------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|Заявитель 0xFB7442a......69e3 |

7. Пользователь получает 1 GALT от контракта AddNewPlot.

Далле - контракт [CreateTerritory](CreateTerritory.md)
