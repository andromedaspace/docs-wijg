# Контракт PlotEscrow  - Требования

## Описание проблемы
Необходимо обеспечить гибкую и надежную продажу токенов SPACE за Эфиры или любые другие токены ERC20 с юридическим оформлением сделки или без нее. Нужно создать ликвидный производный инструмент для крипто-инвесторов, обеспеченные земельными активами.  Сделать так, чтобы передавать токен можно было без изменений права собственности на землю в государственном реестре, но при этом права владельцев токенов были защищены.

## Цели контракта
- Надежный обмен токенов SPACE на любые токены ERC20 или эфиры.
- Обмен с регистрацией сделки по переходу права собственности в государственном реестра.
- Обмен без регистрации перехода прав собственности в государственном реестре.
- Создать экономическую выгоду для того, кто является держателем прав на землю в государственном реестре.

## Термины
`Гарант прав (Custodian / Кастодиан)` - это физическое или юридическое лицо, которое владеет землей в конкретной юрисдикции и зарегистрировано, как собственник в государственном реестре. `Гарант прав` в соответствии с договором обязан зарегистрировать право собственности на земельный участок предъявителю токена по первому требованию последнего или если право не может быть зарегистрировано - передать долю в компании, которая владеет землей. `Гарант прав` проходит проверку Валидатором - юридической фирмой или Нотариусом и проходит KYC. Он получает плату за то, что он `Гарант прав`, если токеном владеет кто-то другой, если это определено заявкой.

## Статусы заявок на регистрацию Кастодиана

| Статус |Описание|
|-------|---------|
|Новая||
|Готова для рассмотрения||
|На рассмотрении||
|Подписан договор||
|Возвращена||
|Утверждена||
|Отклонена||
|Отменена||
|Получено вознаграждение Валидатором||
|Закрыта||

## Типы операций с токенами в контракте
- Регистрация Кастодиана по участку.
- Смена Кастодиана по участку с участием валидатора.
- Продажа токена участка без смены Кастодиана.

## Сценарий UI 1: Регистрация владельца токена участка, как `Гаранта прав`(Кастодиана) по участку.

1. Пользователь может зайти в пункт меню `Стать гарантом прав`.
2. Есть кнопка “Подать заявку”. Всплывает окно для ввода данных:

|Поле|Тип|Значение по умолчанию|Действие|
|------|--------|--------|---------|
|Участок|ID|Значение по умолчанию|При нажатии отображается список токенов Пользователя с картой. Он выбирает участок. Выбирается один токен участка. Должна быть проверка, что Гаранта нет (он еще не назначен) в интерфейсе и контракте PlotEscrow|
|Комиссия Гаранта прав в  GALT|Float|0|Комиссия раз в месяц, которая должна быть перечислена Гаранту прав, устанавливается Заявителем|
|Поле для загрузки документов||0||
|Поле для загрузки фотографий||0||
|Полное имя / Название организации|Строка|0||
|Номер документа(паспорт, номер компании)|Строка|0||
|Комиссия за рассмотрение заявки в GALT|Float|Минимальная комиссия из контракта||
|Рекомендуемая комиссия в GALT|Float|Не редактируется, рассчитывается, как в PlotManager||

Кнопки: Подтвердить и Отмена.

3. При нажатии кнопки подтвердить вычисляется хеш от загруженных документов. Документы и фотографии сохраняются в IPFS.
4. Создается транзакция, вызывающая метод PlotEscrow, которая создает заявку со статусом `Новая`. Все поля можно редактировать кроме хешстроки документов. Можно перезагрузить документы и фотографии, тогда IPFS хеш поменяется.
5. Пользователь нажимает кнопку `Отправить на рассмотрение`, оплачивается комиссия в GALT, статус заявки меняется на `Готова к рассмотрению`. Важно! Генерится стандартный договор между Кастодианом и Валидатором, договор, записывется в IPFS и в контракт записывает хешстрока этого договора. Договор будет подписан позднее.
6. Валидатор, как в PlotManager назначает себе заявку. Статус заявки меняется на `На рассмотрении`. Возможно назначение нескольких Валидаторов.
7. Важно! В отличие от  PlotManager - данные о Гаранте прав открыты. То есть любой может посмотреть, кто он. Full name или название компании пишется в отрутом формате. Ничего не Хешируется.

## Сценарий UI 2: Утверждение Гаранта Прав

0. Валидатор оформляет все необходимые документы для юридического оформления. Фактически здесь Валидатор готовит пакет документов для регистрации компаний на Гаранта прав и перевода земельного участка в собственность этих компаний.
1. Пользователь приходит в офис к Валидатору с документами.
2. Валидатор проверят все, подписывает договор с собственником. Выбирает в меню управления Заявкой кнопку "Подписать договор". Создается транзакция с вызовом метода, которая подписывает договор со стороны Валидатора. Статус заявки меняется на "Договор подписан."
3. Происходят все необходимые юридические действия по регистрации компаний на Гаранта прав и по переводу земельного участка на эти компании. После того, как все юридические действия выполнены - Валидатор подтверждается заявку.
4. Создается транзакция с методом контракта PlotEscrow, которая меняет статус заявки на `Выполнена` и записывает в маппинг Гаранта участка со всеми данными, включая название. Фиксируется размер комиссии Гаранта прав.
5. Нужно просто реализовать маппингами.

## Сценарий UI 3: Возврат заявки на исправление
1. Аналогично PlotManager.
2. Статус = Возвращена.

## Сценарий UI 4: Отклонение заявки
1. Аналогично PlotManager.
2. Статус = Отклонена.

## Сценарий UI 5: Получение комиссий Валидатором и Galt Space.
1. Аналогично PlotManager.

## Сценарий UI 6: Отмена заявки на регистрацию Кастодиана 
1. Заявка в статусе `Новая` может быть отменена Заявителем. При это статус заявки устанавливается в `Отменена`.

## Сценарий UI 7: Продажа токена участка

1. У пользователя есть раздел `Маркетплейс`. При нажатии на кнопку он попадает в отдельный раздел с подразделами: Мои заявки на продажу, Мои заявки на покупку, Все Заявки на продажу.
2. Во всех разделах есть фильтрация по статусам заявок и количество записей, которые можно выводить.
3. При нажатии на Мои заявки на продажу он видит список своих заявок.
4. Есть кнопка `Добавить заявку на продажу`. При нажатии появляется окно с полям для ввода.

|Поле|Тип|Значение по умолчанию|Действие|
|—-—|———|——————|—————|
|Тип продажи|Выпадающий список|Пусто||
|Участок|ID|Значение по умолчанию|При нажатии отображается список токенов Пользователя с картой. Он выбирает участок. Выбирается один токен|
|Гарант прав|Адрес и Full Name|Данные из контракта PlotEscrow|Не редактируется, берется из данных контракта PlotEscrow|
|Комиссия Гаранта прав в  GALT|Float|Данные из контракта PlotEscrow|Комиссия раз в месяц, которая должна быть перечислена Гаранту прав. Берется из контракта PlotManager |
|Поле для ввода суммы оплаты / стоимости участка|Float|Пусто||
|Кнопка с выпадающим списком списка токенов|Список токенов|Пусто||
|Адрес контракта токена|Hex|Пусто|Отображается, если выбран токен, отличный от ETH|

Список токенов: список из MyEtherWallet, первым идет ETH, потом “Другой токен”, потом все остальные.

Кнопки:
- Подтвердить  - создает транзакцию с вызовом метода контракта PlotEscrow.
- Отменить - закрывает окно.

5. При нажатии кнопки подтвердить создается транзакция с вызовом метода PlotEscrow, который:  создается заявку со Статусом `Новая`.
6. Пользователь нажимает отправит заявку, создается транзакция с вызовом метода PlotEscrow. Оплачиваются комиссии, токен участка передается контракту PlotEscrow. Статус меняется на “Открыта”.

## Сценарий UI 4: Принятие сделки покупателем

1. Пользователь в Меню Все заявки на продажу видит весь список заявок.
2. Пользователь для заявки нажимает принять.
3. Создается транзакция с вызовом метода PlotEscrow.
4. Если статус Выполнено, то каждый может забрать свои токены.

## Сценарий UI 5: Проверка сделки валидатором

## Сценарий UI 6: Изменение Гаранта прав.

## Сценарий UI 7: Снятие заявки

## Сценарий UI 8: Начисление, оплата и получение комиссии за Гарантию прав

## Сценарий UI 8: Администрирование
