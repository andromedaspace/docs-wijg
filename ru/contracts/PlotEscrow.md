#Контракт PlotEscrow  - Требования

## Описание проблемы
Необходимо обеспечить гибкую и надежную продажу токенов SPACE за Эфиры или любые другие токены ERC20 с юридическим оформлением сделки или без нее. Нужно создать ликвидный производный инструмент для крипто-инвесторов, обеспеченные земельными активами.  Сделать так, чтобы передавать токен можно было без изменений права собственности на землю в государственном реестре, но при этом права владельцев токенов были защищены.

## Цели контракта
- Надежный обмен токенов SPACE на любые токены ERC20 или эфиры.
- Обмен с регистрацией сделки по переходу права собственности в государственном реестра.
- Обмен без регистрации перехода прав собственности в государственном реестре.
- Создать экономическую выгоду для того, кто является держателем прав на землю в государственном реестре.

## Термины
`Гарант прав (Custodian / Кастодиан)` - это физическое или юридическое лицо, которое владеет землей в конкретной юрисдикции и зарегистрировано, как собственник в государственном реестре. `Гарант прав` в соответствии с договором обязан зарегистрировать право собственности на земельный участок предъявителю токена по первому требованию последнего или если право не может быть зарегистрировано - передать долю в компании, которая владеет землей. `Гарант прав` проходит проверку Валидатором - юридической фирмой или Нотариусом и проходит KYC. Он получает плату за то, что он `Гарант прав`, если токеном владеет кто-то другой, если это определено заявкой.

## Статусы заявок на регистрацию Кастодиана

| Статус |Описание|
|-------|---------|
|Новая||
|Готова для рассмотрения||
|На рассмотрении||
|Возвращена||
|Утверждена||
|Отклонена||
|Отменена||
|Получено вознаграждение Валидатором||
|Закрыта||

## Сценарий UI 1: Регистрация владельца токена участка, как `Гаранта прав` прав по участку.

1. Пользователь может зайти в пункт меню `Стать гарантом прав`.
2. Есть кнопка “Подать заявку”. Всплывает окно для ввода данных:

|Поле|Тип|Значение по умолчанию|Действие|
|------|--------|--------|---------|
|Участок|ID|Значение по умолчанию|При нажатии отображается список токенов Пользователя с картой. Он выбирает участок. Выбирается один токен участка. Должна быть проверка, что Гаранта нет (он еще не назначен) в интерфейсе и контракте PlotEscrow|
|Комиссия Гаранта прав в  GALT|Float|0|Комиссия раз в месяц, которая должна быть перечислена Гаранту прав, устанавливается Заявителем|
|Поле для загрузки документов||0||
|Полное имя / Название организации|Строка|0||
|Номер документа(паспорт, номер компании)|Строка|0||
|Комиссия за рассмотрение заявки в GALT|Float|Минимальная комиссия из контракта||
|Рекомендуемая комиссия в GALT|Float|Не редактируется, рассчитывается, как в PlotManager||

Кнопки: Подтвердить и Отмена.

3. При нажатии кнопки подтвердить вычисляется хеш от загруженных документов. Документы сохраняются в IPFS.
4. Создается транзакция, вызывающая метод PlotEscrow, которая создает заявку со статусом `Новая`. Все поля можно редактировать кроме хешстроки документов.
5. Пользователь нажимает кнопку `Отправить на рассмотрение`, оплачивается комиссия в GALT, статус заявки меняется на `Готова к рассмотрению`. Важно! Генерится договор, записывется в IPFS и в контракт записывает хешстрока этого договора. Договор будет подписан позднее.
6. Валидатор, как в PlotManager назначает себе заявку. Статус заявки меняется на `На рассмотрении`.
7. Важно! В отличие от  PlotManager - данные о Гаранте прав открыты.  То есть любой может посмотреть, кто он. Full name или название компании пишется в отрутом формате.

## Сценарий UI 2: Утверждение Гаранта Прав

1. Пользователь приходит в офис к Валидатору с документами.
2. Валидатор проверят все, подписывает договор с собственником и нажимает кнопку Подтвердить.
3. Создается транзакция с методом контракта PlotEscrow, которая меняет статус заявки на `Выполнена` и записывает в маппинг Гаранта участка со всеми данными, включая название. Фиксируется размер комиссии Гаранта.
4. Нужно просто реализовать маппингами.

## Сценарий UI 3: Возврат заявки на исправление
1. Аналогично PlotManager.

## Сценарий UI 4: Отклонение заявки
1. Аналогично PlotManager.

## Сценарий UI 5: Получение комиссий Нотариусом и Galt Space.
1. Аналогично PlotManager.

## Сценарий UI 6: Отмена заявки на регистрацию Кастодиана 
1. Заявка в статусе `Новая` может быть отменена. При это статус завяки устанавливается в `Отменена`.

## Сценарий UI 6: Выставление участка на продажу Кастодианом

1. У пользователя есть раздел `Маркетплейс`. При нажатии на кнопку он попадает в отдельный раздел с подразделами: Мои заявки на продажу, Мои заявки на покупку, Все Заявки на продажу.
2. Во всех разделах есть фильтрация по статусам заявок и количество записей, которые можно выводить.
3. При нажатии на Мои заявки на продажу он видит список своих заявок.
4. Есть кнопка `Добавить заявку на продажу`. При нажатии появляется окно с полям для ввода.

|Поле|Тип|Значение по умолчанию|Действие|
|—-—|———|——————|—————|
|Участок|ID|Значение по умолчанию|При нажатии отображается список токенов Пользователя с картой. Он выбирает участок. Выбирается один токен|
|Гарант прав|Адрес и Full Name|Данные из контракта PlotEscrow|Не редактируется, берется из данных контракта PlotEscrow|
|Комиссия Гаранта прав в  GALT|Float|Данные из контракта PlotEscrow|Комиссия раз в месяц, которая должна быть перечислена Гаранту прав. Берется из контракта PlotManager |
|Поле для ввода суммы оплаты / стоимости участка|Float|Пусто||
|Кнопка с выпадающим списком списка токенов|Список токенов|Пусто||
|Адрес контракта токена|Hex|Пусто|Отображается, если выбран токен, отличный от ETH|
|Чекбокс `Проверка сделки Нотариусом`|Чекбокс|True||
|Тип продажи|Выпадающий список|Пусто||
|Поле ввода суммы комиссии в GALT за валидацию|Float|Минимальная комиссия| Отображается если выбрана Проверка сделки валидатором|
|Рекомендуемая комиссия за валидацию |Float|Рассчитанная рекомендуемая комиссия|Не редактируется|
|Поле ввода суммы комиссии в GALT за регистрацию перехода права собственности|Float|Минимальная комиссия| Отображается если выбран тип продажи “Со сменой Гарант прав”|

Список токенов: список из MyEtherWallet, первым идет ETH, потом “Другой токен”, потом все остальные.

Типы продажи:
- Без смены Кастодиана - Подсказка: Гарант прав - это физическое или юридическое лицо, которое владеет землей в конкретной юрисдикции. Гарант прав в соответствии с договором обязан зарегистрировать право собственности на земельный участок предъявителю токена по первому требованию. Соответственно передача токена может происходить без смены Гарант прав.
- Со сменой Кастодиана  - В этом случае Валидатор сделки осуществляет регистрацию перехода права собственности на земельный участок в государственном органе от одного Гаранта другому.
- Залог. При этом этом типе продажи токены переходят Гаранту, но он не может выполнять с ними операции. Покупатель может в любой момент вернуть участок и получить обратно токены или Эфиры.

Кнопки:
- Подтвердить  - создает транзакцию с вызовом метода контракта PlotEscrow.
- Отменить - закрывает окно.

5. При нажатии кнопки подтвердить создается транзакция с вызовом метода PlotEscrow, который:  создается заявку со Статусом `Новая`.
6. Пользователь нажимает отправит заявку, создается транзакция с вызовом метода PlotEscrow. Оплачиваются комиссии, токен участка передается контракту PlotEscrow. Статус меняется на “Открыта”.

## Сценарий UI 4: Принятие сделки покупателем

1. Пользователь в Меню Все заявки на продажу видит весь список заявок.
2. Пользователь для заявки нажимает принять.
3. Создается транзакция с вызовом метода PlotEscrow. Статус заявки меняется на :
     - если сделка не проверяется Валидатором и не происходит смены гаранта прав, то статус Выполнено.
4. Если статус Выполнено, то каждый может забрать свои токены.

## Сценарий UI 5: Проверка сделки валидатором

## Сценарий UI 6: Изменение Гаранта прав.

## Сценарий UI 7: Снятие заявки

## Сценарий UI 8: Начисление, оплата и получение комиссии за Гарантию прав

## Сценарий UI 8: Администрирование
