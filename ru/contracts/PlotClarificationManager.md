# PlotClarificationManager - Требования


## Описание проблемы
Необходимо создать инструмент для уточнения геохешей для уже созданного участка путем утверждения Заявки Валидатором или Валидаторами.


## Статусы заявок

### Сценарий №1: Уточнение геохешей участка - Не реализовано

0. Вводим тип заявки - Уточнение геохешей.

1. У пользователя в меню Мои участки в контекстном меню по операциям с участком отображается кнопка `Уточнить геохеши участка`.

2. Если пользователь нажал кнопку, то появляется меню для ввода данных по заявке аналогично созданию новой заявки: кадастровый номер, полное имя и номер документа, точность апроксимации. Пользователь нажимает Создать. Создается транзакция с вызовом метода контракта PlotManager, который создает заявку со статусом Новая и передает токен Участка контракту PlotClarificationManager.

3. Пользователь заходит в меню Мои заявки. Нажимает кнопку "Отправить заявку на оценку". Создается транзакция с вызовом метода контракта PlotClarificationManager. Статус заявки меняется на "Отправлена на оценку".

4. Валидатор, имеющий Роль = "Добавление геохешей" нажимает кнопку "Забрать заявку". Для этого статуса заявки нужен только один валидатор с этой Ролью. Статус меняется на - "Оценка стоимости".

5. Валидатор, имеющий Роль = "Добавление геохешей" нажимает кнопку "Оценить стоимость" (кнопка доступная только этой роли), строится апроксимация геохешей (строго по переменной из заявки) и происходит примерный расчет стоимости создания и добавления геохешей в Участок. Валидатор нажимает кнопку "Отправить на оплату", создается транзакция с вызовом метода, который записывает стоимость комиссии в GALT, исходя из текущего курса и расходов на газ. Статус заявки - "Ожидание оплаты".

6. Пользователь для заявок со статусом Ожидание оплаты видит кнопку Оплатить. При нажатии кнопки создается транзакция с вызовом метода. Статус заявки - "Оплачена, ожидает утверждения".

7. Остальные роли могут назначить себе заявку. Первый Валидатор, который уже назначен - остается. Статус меняется на "На утвреждении".

8. После того как все валидаторы утвердили заявку статус меняется на "Утверждена".

9. Валидатор с ролью "Добавление геохешей" видит для заявок со статусом "Утверждена" кнопку "Добавить геохеши". Создается серия транзакций по добавлению геохешей в Упаковку. Упаковка и Геохеши принадлежат PlotManager.

10. Создается транзакция, которая передает токен Участка обратно пользователю. Статус заявки меняется на "Уточнение произведено".

11. Валидаторы могут забрать свои награды из статуса "Уточнение произведено" и изменить статус Заявки `Получено вознаграждение валидатора`.

12. Адрес получателя комиссии может забрать свою комиссию и изменить статус на Закрыта.

13. Данный вид заявок не имеет функции отклонение.

14. Валидатор может вернуть заявку на доработку аналогично заявке на создание нового участка. 

15. Пользователь в меню действий по заявке может нажать кнопку `Вернуть участок`. Эта кнопка отображается для заявок со статусом Новая, Возвращена, Ожидание оплаты. При ее нажатии создается транзакция, которая возвращает токен Участка пользователю и меняет статус на "Разобрана заявителем". Так же пользователь может создать транзакцию и вернуть оплаченную комиссию из этих статусов.

16. Для валидатора для заявок со статусом Уточнение произведено, Отклонена, Разобрана заявителем отображается кнопка Получить вознаграждение.
