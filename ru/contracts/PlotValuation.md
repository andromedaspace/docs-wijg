# PlotValuation

## Цель контракта 

* Возможность оценить стоимость земельного участка в токенах GALT с целью получения залога.

## Роли заявки
Роли валидаторов, используемые в заявках, жестко прописаны в контракте PlotValuation.
Список ролей в контракте Validators, который задается вручную, должен четко ему соответствовать

* `appraiser` - Оценщик
* `appraiser2` - Контролер-оценщик
* `auditor` - Аудитор

## Содержание заявки
* ID токена упаковки
* Список хешей прилагаемых документов из IPFS. Задается только один раз и не может быть модифицирован.

## Статусы заявок
* `SUBMITTED` - новая заявка, сразу после создания готова к рассмотрению валидаторами
* `VALUATED` - оценена первым оценщиком
* `CONFIRMED` - подтверждена вторым оценщиком
* `REVERTED` - не подтверждена вторым оценщиком
* `APPROVED` - подтверждена аудитором

![Application Status List](../../images/PlotValuation.png?raw=true "Application Status List")

## Статусы ролей
* `PENDING` - ожидает блокировки валидаторов с данной ролью
* `LOCKED` - заблокирована валидатором с данной ролью

## Интерфейс для владельца контракта
Владелец контракта может:
* Изменить минимальный размер комиссии в ETH
* Изменить минимальный размер комиссии в GALT
* Изменить долю комиссии, распределяемой в пользу GaltSpace в ETH (остаток распределяется в пользу валидаторов)
* Изменить долю комиссии, распределяемой в пользу GaltSpace в GALT (остаток распределяется в пользу валидаторов)
* Установить, какой из способов оплаты сейчас принимается (никакой, GALT, ETH, GALT И ETH)
* Установить адрес выплат комиссий от огранизации GaltSpace
* Остановить/Возобновить работу контракта (напр. в случае подозрения на наличие уязвимости)

#### #resetApplicationRole()
Владелец контракта может снять конкретного валидатора с роли в заявке

* Метод возможен только для
    * Заявок в статусе SUBMITTED
    * Ролей в статусе LOCKED

#### #claimGaltSpaceReward()
Владелец контракта забирает свою долю комиссии, оплаченную заявителем

* Метод возможен только для заявок в статусе APPROVED
* В зависимости от выбранной валюты, на адрес, указанный владельцем контракта, перечисляются либо ETH либо GALT

## Интерфейс для заявителя
#### #submitApplication()
Заявитель подает заявку на оценку токена

* Статус заявки устанавливается в SUBMITTED
* В заявку из контракта Validators копируется список текущих ролей для валидации
* Оплачивается комиссия в ETH или GALT
* Всем скопированным ролям назначается статус PENDING

## Интерфейс для валидаторов
#### #lockApplication()
Валидатор с указанной ролью блокирует за собой право на рассмотрение заявки

* Метод доступен только для заявок в статусе SUBMITTED
* Метод доступен только для ролей в статусе PENDING
* Статус заявки не меняется
* Статус роли переходит в LOCKED

#### #valuatePlot()
Валидатор с ролью `оценщик` первоначально оценивает стоимость участка в GALT токенах

* Метод доступен только для заявок в статусе SUBMITTED
* Метод доступен только для ролей в статусе LOCKED
* Статус заявки не меняется VALUATED

#### #valuatePlot2()
Валидатор с ролью `контролер - оценщик` проверяет оценку первого оценщика

* Метод доступен только для заявок в статусе VALUATED
* Метод доступен только для ролей в статусе LOCKED
* Если оценки первого и текущего оценщиков совпадают, статус заявки меняется на CONFIRMED
* Если оценки не совпадают, статус заявки меняется на REVERTED

#### #approveValuation()
Валидатор с ролью `аудитор` может одобрить заявки в случае

* Метод доступен только для заявок в статусе CONFIRMED
* Метод доступен только для ролей в статусе LOCKED
* Метод доступен только в случае, если оценки первого и текущего оценщиков совпадают
* Статус заявки меняется на APPROVED
* Обновляется запись в реестре оценок для текущего токена упаковки
* Валидаторы могут забрать свои вознаграждения
* GaltSpace может забрать свое вознаграждение

#### #claimValidatorReward()
Валидатор забирает свое вознаграждение

* Метод доступен только для заявок в статусе APPROVED
* В зависимости от типа заявки, на адрес валидатора перечисляются либо ETH либо GALT
* Поставляется флаг, что валидатор на данной роли получил вознаграждение
* Статус заявки не изменяется
