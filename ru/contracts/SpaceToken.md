# SpaceToken - Требования

## Описание проблемы
Необходим способ учета и адресации отдельных Земельных участков в Проекте с возможностью их передачи между Участниками проекта. Необходима возможность учитывать дополнительные параметры, привязанные к каждому Земельному участку, такие как Залог, Верхняя и Нижняя граница участка и.т.д.

## Цели контракта
- Создать отвечающий стандартам [OpenZeppelin ERC721](https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/token/ERC721).
- Сделать идентификатором каждого токена Геохеш Земельного участка, которому соответсвует этот токен.
- Сделать возможным создавать уникальные токены Земельных участков, которые будет содержать в себе большое количество стандартных токенов, адресуемых геохешами.

## Ограничения
Существует 2 типа SPACE - токенов:
- Стандартный SPACE - токен, у которого id представляет собой Геохеш.
- SPACE - токен уникального произвольного участка с уникальным идентификатором.

## Сценарий контракта
### Сценарий 1: Создание SPACE токена после создания заявки на Аукционе земли
1. Контракт SpaceAuction вызывает метод MintSpace(geohash) после того, как был создан Аукцион на новый конкретный Земельный участок и все проверки были сделаны, где geohash - геохеш Земельного участка. 

2. Контракт SpaceToken создает токен SPACE с идентификатором geohash. Владельцем токена становится контракт SpaceAuction.
3. После того, как SPACE был создан и его Владельцем стал контракт SpaceAuction, происходит выполнение контракта SpaceAuction для этого токена.
### Сценарий 2: Первичная продажа SPACE токена после того, как Пользователь выиграл Аукцион земли на конкретный участок
1. После успешной продажи на Аукционе земли SPACE токена своему первому владельцу - SpaceAuction вызывает функцию transfer(winnerAdress, winningbet), где winnerAdress - адрес победителя аукциона, winningbet - ставка, которая победила.
2. winningbet передается в FundRegistry.onTransferReputationWithinFund и будет использоваться как репутация SPACE токена или так называемый Залог в GALT токенах.
3. Токен SPACE передается от адреса контракта SpaceAuction адресу Владельца земли и за него сделан залог в GALT токенах в размере цены его продажи или winningbet в контракте FundRegistry.
### Сценарий 3: Передача SPACE токена другому владельцу
1. При передачи другому  Владельцу вызывается transfer(newowneradress) или transferFrom, но последний аргумент winningbet не разрешено указывать, так как эту функцию вызывает не SpaceAuction, а текущий Владелец токена SPACE.
2. Функция transfer или transferFrom инициирует функцию FundRegistry.onTransferReputationWithinFund, которая обеспечивает уменьшение Репутации бывшего владельца и увеличение Репутации нового Владельца.
3. Таким образом при передачи SPACE токена так-же передается и его Репутация: у старого владельца отнимается, и начисляется новому владельцу.
4. Сам Залог в токенах GALT не перемещается и остается и Фонда.

### Сценарий 4: Создание уникальных участков
1. Владелец  SPACE токенов может вызвать метод контракта SplitMerge и создать уникальный токен SPACE с уникальным идентификатором, например ghskkdsd73883nncjsgs6644. Владелец SPACE - токена ghskkdsd73883nncjsgs6644 контракт SplitMerge.

2. Владелец  SPACE токенов может вызвать метод контракта SplitMerge и добавить к созданному уникальному токену ghskkdsd73883nncjsgs6644 маппинг <id уникального токена> - <id стандартного токена с геохешем>.
Например, у пользователя есть 2 токена: [w24qg86](http://explorer.galtproject.io/map/#w24qg86) и [w24qg87](http://explorer.galtproject.io/map/#w24qg87). Он вызывает метод и записывает маппинг:

|id уникального участка|id геохеша|
|------------------|------------|
|ghskkdsd73883nncjsgs6644|[w24qg86](http://explorer.galtproject.io/map/#w24qg86)|
|ghskkdsd73883nncjsgs6644|[w24qg87](http://explorer.galtproject.io/map/#w24qg87)|

Пользователь записал маппинг.

3. Теперь пользователь может вызвать метод MergeCustomPlot контракта SplitMerge и указать в качестве аргумента ghskkdsd73883nncjsgs6644. 

3.1.1 Контракт SplitMerge проверяет, что ghskkdsd73883nncjsgs6644 принадлежит ему.

3.1.2. Контракт SplitMerge выполняет переводит токен ghskkdsd73883nncjsgs6644 пользователю, а токены [w24qg86](http://explorer.galtproject.io/map/#w24qg86) и [w24qg87](http://explorer.galtproject.io/map/#w24qg87) переводит себе.

3.1.3. Контракт SplitMerge переносит Залоги с w24qg87 и w24qg86 на ghskkdsd73883nncjsgs6644.

## Спецификация контракта
### Модификации
- Добавлено поле daoRegistry и функция setDaoRegistry чтобы при совершении операций со SPACE токеном - производились соответствующие операции с залоченными токенами GALT за соответствующим SPACE токеном.
- Функция transferFrom переопределена для добавления аргумента reputation, который можно указывать только при первичной продаже токенов чтобы зафиксировать c помощью контракта DaoRegistry сколько за этим SPACE токеном будет числиться репутации.
### Связи с другими контрактами
- В контракте аукциона содержится логика для создания новых SPACE токенов и определения за ними базовой репутации - залоченных токенов
- В контракте Reputation хранится количество GALT токенов, залоченных за SPACE токеном
- В контракте управления высотами содержится информация о верхней и нижней границе, на которую имеет право владелец SPACE токена

## Особенности реализации на Solidity
## Владелец Контракта
Владельцем контракта является GALT Project CORE Team.

## Особенности реализации на TypeScript

## Неоднозначные вопросы и ответы на них
Q: Каким образом можно будет пополнять залоченные токены GALT? Из какого контракта это будет происходить?

A: Должно производится из контракта Репутации.

Q: Каким образом и из какого контракта будут производится штрафы из баланса залоченных GALT токенов?

A: Должно быть описано отдельным функционалом в отдельном контракте Штрафа Репутации
