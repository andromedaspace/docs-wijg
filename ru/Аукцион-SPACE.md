# Контракт Аукцион земли - Требования

* Epic issue https://github.com/andromedaspace/WIJG/issues/363
* UI Mindmap https://mm.tt/1116945428?t=Ko5NjQKJPi

## Описание проблемы
Необходимо обеспечить первичную продажу по максимально честной и выпуск SPACE токенов с условием того, что на аукцион переданы родительские SPACE токены,
которые определяют допустимую область земли, на которой можно через аукцион приобрести дочерние SPACE токены.
Таким образом нужно чтобы аукцион позволял сделать ставку на ещё не выпущенный SPACE токен но в разрешенной области земли,
чтобы после успешной продажи - SPACE токен был создан и назначен своему первому владельцу - победителю аукциона.

## Цели контракта
- SPACE токены нужно продавать на аукционе по максимально честной цене избежав недостатки традиционного аукциона, когда опоненты перебивают ставки по минимальному увеличению цены.
- Необходимо реализовать аукцион земли базируясь на абстрактном классе [Аукциона Викри](Аукцион-Викри.md) со всеми его требованиями.
- Дать возможность пользователям самим выбирать какой они хотят купить геохеш из доступной области на аукционе.
- Избежать ситуации когда пользователи покупают родительские геохеши с наибольшей площадью участков и на этом аукцион первичной продажи заканчивается.

## Основные требования:
- Аукцион должен выпускать SPACE токены при первичной продаже если была осуществлена успешная продажа и токен является дочерним к выставленному на аукцион.
- Минимальная цена на геохеш должна определяться величиной области участка геохеша: чем больше область - тем больше цена
- Наибольшие участки геохешей должны быть с неподъемной минимальной ценой, чтобы пользователи могли покупать только участки поменьше
- При вторичной продаже SPACE токена - необходимо обеспечить стандартную работу аукциона без возможности выпуска нового дочернего токена
- Дать возможность устанавливать на каждый лот свою минимальную цену
- Минимальная цена лота будет определяться базовой стоимостью 100 GALT или репутацией SPACE токена
- Победитель лота аукциона получает во владение SPACE токен

## Сценарий контракта
### Сценарий 1: Первичная продажа SPACE токена
1. Пользователь 2 находит информацию о том, какие родительские хеши выставлены на аукционе
2. Пользователь 2 выбирает какой из дочерних геохешей он хочет приобрести
3. Пользователь 2 проверяет что, тот геохеш, который он хочет приобрести - доступен для продажи:
- один из его родителей находится на аукционе(если пользователь хочет купить sezu0123 - то sezu012 или sezu01 или sezu0 должно находится на аукционе);
- он и его родители ещё не проданы(если пользователь хочет купить sezu0123 - то sezu012 или sezu01 или sezu0 не должны быть проданы);
4. Пользователь 2 получает информацию о минимальной цене на этот геохеш: 100 GALT
5. Пользователь 2 делает ставку на этот геохеш, которая должен быть больше его минимальной цены: 600 GALT публичной ставки и 300 GALT секретной ставки
6. Пользователь 1 делает ставку на тот-же геохеш: 400 GALT публичной ставки и 200 GALT секретной ставки
![image](https://user-images.githubusercontent.com/4842007/41902701-6114264a-7934-11e8-83f0-30d647966d43.png)
7. После окончания приода действия аукциона на этот лот - пользователь вызывает функцию finishAuction, получая обратно разницу между второй секретной ставкой(200 GALT) в топе и своей публичной ставкой: 400 GALT
8. finishAuction создает SPACE токен, который получает залог 200 GALT

### Сценарий 2: Продажа после отказа владельцем от SPACE токена. Единственный покупатель на аукционе
1. Пользователь отказывается от SPACE токена с залоченными 500 GALT за ним
2. SPACE токен оказывается на аукционе с минимальной ценой 500 GALT
3. На данный лот ставит единственный пользователь публичную ставку 700 GALT и секретную ставку 600 GALT
4. Больше никто не ставит на данный лот
5. Спустя какое-то время аукцион заканчивается и победитель получает разницу между 700 и 500: 200 GALT
6. Также победитель получает во владение данный SPACE токен

### Сценарий 3: Продажа после отказа владельцем от SPACE токена. Ставка равна минимальной цене
1. Пользователь отказывается от SPACE токена с залоченными 400 GALT за ним
2. SPACE токен оказывается на аукционе с минимальной ценой 400 GALT
3. На данный лот ставит единственный пользователь публичную ставку 400 GALT и секретную ставку 400 GALT
4. Больше никто не ставит на данный лот
5. Так как суммы публичной ставки и минимальной цены равны - пользователь не получает разницу между ценами, так как она равна 0
6. Победитель получает во владение данный SPACE токен

## Спецификация контракта
- Название класса: SpaceAuction
- Наследуется от абстрактного класса [Аукциона Викри](Аукцион-Викри.md)
- Добавлена связь с токеном SPACE для проверки наличия у продавца SPACE токена и передачи SPACE токена при успешной продаже
- Добавляется право на создание SPACE токенов, геохеши которых являются дочерними к тем, чтобы были выложены на аукцион
