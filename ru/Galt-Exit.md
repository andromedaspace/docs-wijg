# Функционал обратного выкупа Galt токена - Требования

## Описание проблемы
Каждый пользователь имеет право в любой момент вернуть свои ETH, которые он потратил на покупку Galt токена.

## Цели контракта
- Сделать функционал, который позволит пользователю обменивать Galt токены на ETH;

## Сценарий контракта
### Сценарий 1: Обратный выкуп
Вводные пользователя Б:

| Адрес пользователя | Баланс в Galt | Баланс в ETH |
| ---------- | --------- | --------- |
| 0xca2...88f | 30 000 | 10 |
| Остальные адреса | X | Y |

Фонды:

| Адрес фонда | Баланс в ETH | Баланс в GALT |
| ---------- | --------- | --------- |
| 0xa0a...b2b | 200 | 200 000 |
| 0x7ca...90c | 300 | 200 000 |

Контракт адрес выкупа:

| Баланс в GALT |
| ---------- |
| 0 |

Выход из GALT выполняется раундами по X часов.
1. Начинается раунд 1.
2. Пользователь создает заявку на вывод GALT вызывая метод createProposal контракта GaltExit. В аргумент к методу Пользователь Б передает кол-во GALT (20 000), которые он хочет обменять. В заявке фиксируется число репутации во всех фондах.
3. Затем в течении раунда 1 Пользователь Б вызывает метод executeProposalForFund, передавая в аргумент адрес фонда. В методе фиксируется кол-во репутации и ETH для фонда, адрес которого был передан в метод. Так же по мере транзакций пользователя в методе фиксируется общее количество репутации и ETH для всех фондов, адреса которых были переданы в аргумент. Этот метод необходимо вызывать для всех фондов!
4. После вызова метода executeProposalForFund для всех своих фондов Пользователь Б вызывает метод finishProposal. В методе происходит проверка, отличается ли общее кол-во всех зафиксированных репутаций от общей репутации во всех фондах. Если различия не более 1%, и если прошло не более суток с момента создания заявки, то пользователь может вызвать метод closeProposal, переключая статус заявки на закрытую.
5. Пользователь вызывает метод getEthFromFund для каждого фонда, передавая в аргумент адрес фонда. Если раунд еще не закончен, то у пользователя забирается часть GALT, которую он указал в заявке и возвращается ETH, по формуле (ОБЩЕЕ КОЛ-ВО ВЫПУЩЕННЫХ GALT - БАЛАНС В GALT ФОНДА) / ОБЩИЙ БАЛАНС ETH ВО ВСЕХ ФОНДАХ:

| Адрес фонда | Баланс в ETH | Баланс в GALT | 1 ETH в GALT | Результат |
| ---------- | --------- | --------- | -----------| ------------|
| 0xa0a...b2b | 200 | 200 000 | (500 000 - 200 000) / 500 = 600 | 20 0000 / 600 = 33,33 |
| 0x7ca...90c | 300 | 200 000 | (500 000 - 300 000) / 500 = 600 | 20 0000 / 600 = 33,33 |

Балансы пользователя Б на окончание 1-ого раунда:

| Адрес пользователя | Баланс в Galt | Баланс в ETH |
| ---------- | --------- | --------- |
| 0xca2...88f | 10 000 | 76,66 |
| Остальные адреса | X | Y |

Фонды:

| Адрес фонда | Баланс в ETH | Баланс в GALT |
| ---------- | --------- | --------- |
| 0xa0a...b2b | 166,67 | 200 000 |
| 0x7ca...90c | 266,67 | 200 000 |

Контракт адрес выкупа:

| Баланс в GALT |
| ---------- |
| 20 000 |

6. Раунд 1 окончен.

## Спецификация контракта

## Детальный Сценарий пользователя и описание интерфейса

## Ограничения для реализации на Solidity

## Ограничения для реализации на TypeScript

## Неоднозначные вопросы и ответы на них
### В каком виде должны хранится GALT в контракте "адрес выкупа"? 

### По какому курсу пользователи смогут купить GALT в контркте "адрес выкупа"?

### Сколько часов должен длиться один раунд?

### Какое различие можно допустить при сравнении общего кол-ва всех зафиксированных репутаций на момент вызова finishProposal от общей репутации во всех фондах? 1% или больше?
