# Sprint 5

## Web3 Application, 20 часов
  - Подготовить приложение для мультиязычности
    - **Сделано** Создать и подгружать JSON ru файл со всеми русскими именами и текстами, 30 мин
    - **Сделано** Создать плагин для получения текста по имени, 120 мин
    - **Сделано** Создать фильтр для получение текста по имени из шаблонов VUE, 30 мин
    - **Сделано** Использовать шаблонизатор для вставки переменных в тексты, 60 мин
    - **Сделано** Перенести все тексты из приложения в JSON файл, 120 мин
    - **Сделано** Передавать переменные вместе с текстами для использования в шаблонах, 60 мин
  - Перевести Frontend на новую версию контрактов PlotManager и Validators
    - **Сделано** Получение и отображение списка ролей валидатора, 30 мин
    - **Сделано** Получение списка ролей заявки, 30 мин
    - **Сделано** Получение статуса по каждой из ролей в заявке:(одобрена или не одобрена), 30 мин
    - **Сделано** Указание роли валидатором при назначении заявки, 30 мин
    - **Сделано** Подача заявки GALT или ETH (селектор и предупреждение с размером комиссии), 60 мин
    - **Сделано** Возможность установки большей комиссии, 15 мин
    - Редактирование деталей завявки Апликантом при создании заявки и возвращении от валидатора, 60 мин
    - Админка с указанием ролей и долей в эфирах и галтах по типу заявки
      - **Сделано** Отображение таблички, 120 мин
      - **Сделано** Редактирование таблички, 60 мин
      - **Сделано** Проверка того что сумма всех процентов - 100, предупреждение если не так, 30 мин
      - **Сделано** Отправка всех данных таблички одной транзанкцией, 30 мин
    - **Сделано** Получение списка ролей по типу заявки(тип указан в PlotManager), 30 мин
    - **Сделано** Проверить на изменение полей заявки, 30 мин
    - Возврат оплаченного залога заявителю по заявке в статусе Утвержденна, либо в статусе Разобрана заявителем, 60 мин
    - Отправка оплаченного залога валидатору по итогам разбора заявки, 30 мин
  - Интерфейс SpaceDex
    - Страница SpaceDex: список участков с картой рядом, 30 мин
    - Список доступных Space токенов для покупки с ценами, 60 мин
    - Кнопка для покупки Space токена за GALT, 30 мин
    - Список доступных Space токенов для продажи с ценами, 60 мин
      - Проверка и фильтрация Space токенов на возможность продажи(установлена цена и одобрен)
    - Кнопка для продажи Space токена за GALT, 30 мин
    
## Контракты: Женя, 10 часов
  - SpaceDex
    - **Сделано** SetPlotCustodianManagement, 30 мин
      - Установка адреса контракта для получения цены за Space токен и статуса доступности для продажи
    - **Сделано** ExchangeSpaceToGalt, 90 мин
      - Получение цены Space токена из PlotCustodianManagement
      - Передача Space токена участка контракту PlotCustodianManagement, а Galt токенов пользователю
      - Запись Space токена в динамический массив
    - **Сделано** ExchangeGaltToSpace, 90 мин
      - Получение цены Space токена из PlotCustodianManagement
      - Передача Galt токенов контракту PlotCustodianManagement, а Space токена пользователю
      - Удаление Space токена из динамического массива
    - **Сделано** Кешированние суммы всех цен Space токенов для вычитания их GaltDex, 60 мин
    - **Сделано** Заглушка GetSpacePrice с постоянной ценой, 10 мин
    - **Сделано** Заглушка AvailableForSell с постоянным true, 10 мин
    - Написание тестов, 120 мин
  - GaltDex
    - SetSpaceDex, 30 мин
      - Установка адреса контракта SpaceDex для получение суммы всех цен
    - Вычитание суммы всех цен Space токенов при расчете курса GALT, 30 мин
    - Вычитание баланса SpaceDex при расчете курса GALT, 30 мин
    - Написание тестов, 90 мин

## Common	
* Переместить методы на external где возможно	30 мин
* Добавить копирайты	15 мин
* Пофиксить грамматику в текстах тестов	30 мин
	
## PlotManager	
* Переименовать applyForPlotOwnership => add *Eth	30 мин
* FeeManager role	90 мин
* Gas commission calculation	120 мин
* Депозит газа при подаче заявки на рассмотрение (при submitApplication())	150 мин
* Добавить Validators.getValidatorRoles()	15 мин
* Разборка упаковки в статусе REVERTED только заявителем	30 мин
* Возврат залога заявителем	60 мин
* Получение залога валидатором	90 мин
* Получение вознаграждения валидаторами и galtSpace без указания валюты	60 мин
	
## PlotClarificationManager	
* #claimValidatorDeposit()	90 мин
* #claimApplicantGasDeposit()	120 мин
* Передача токена обратно заявителю #withdrawPackageToken()	90 мин
* Метод revertApplication()	90 мин
* Редактирование полей заявки (сразу всех)	90 мин
	
## PlotCustodianManagement
* Составление спецификации методов и схемы движения статусов	360 мин


## Solidity bot (21 часов) Игорь

### Status
 - Изучить дальнейшие перспективы ботов в мессенджере, 120 мин

### Внедрение контрактов
 - GaltToken
   - Описание моделей методов, 180 мин
   - Описание моделей интерфейса, 180 мин
   - Тестирование интерфейса, 60 мин
 - SpaceToken
   - Описание моделей методов, 180 мин
   - Описание моделей интерфейса, 180 мин
   - Тестирование интерфейса, 60 мин
 - GaltDEX
   - Описание моделей методов, 120 мин
   - Описание моделей интерфейса, 120 мин
   - Тестирование интерфейса, 60 мин

## Технические задачи (13 часов) Игорь
 - Обеспечить ревью кода (600 мин)
 - Настроить мониторинг нод Parity, 180 мин
   - Настроить систему оповещения в telegram

## Контент (11 часов) Игорь
 - Написать статьи отвечающие на вопросы
   - Какими свойствами должен обладать идеальный токен имущественного права? 180 мин
   - Что такое геохеш? 120 мин
   - Преимущества и недостатки стандартов геопозиционирования. 180 мин
 - Обновить видео по обновленному функционалу, 180 мин

## Backlog WebApplication
  - **Сделано** При наличии у встроенного кошелька остаточного баланса - ждать в модальном окне пополнения встроеннго кошелька - поступления этого баланса и предупреждать об этом пользователя(Фикс бага минусового баланса)
  - **Сделано** Обновлять данные в модальном окне пополнения встроенного при сторонних поступлениях эфиров на этот кошелек(если пользователь хочет отправить эфиры вручную или они пришли с прошлого встроеннго кошелька)
  - **Сделано** Сохранение и восстановление выбранного пользователем языка после перезагрузки страницы
  - **Сделано** Подгрузка словарей мультиязычности через AJAX отдельными файлами для масштабируемости
  - **Сделано** Переключатель языка с автоматической заменой всех слов в интерфейсе без перезагрузки
  - **Сделано** Выводить токены SPACE в hex в интерфейсе
  - **Сделано** Сделать директиву для сокращения hex строк в интерфейсе с возможностью скопировать полную версию в буфер обмена
  - Перевести Frontend на новую версию контрактов PlotManager и Validators
    - **Сделано** Расчет необходимого депозита для submit заявки и отправка его вместе с транзанкцией на submit
    - **Сделано** Выводить предупреждение пользователю о том что необходимо дополнительно отправить залог для submit заявки
    - **Сделано** Новая логика фильтрации по lockForReview статусу для пользователя в условиях множества валидаторов у заявки 
    - **Сделано** Валидировать отсутствие статусов pending у всех ролей в заявке для возможности валидатору совершить дальнейшие действия
    - **Сделано** Выводить валидатору предупреждение если у одной из ролей валидации статус pending
    - Админка с указанием ролей и долей в эфирах и галтах по типу заявки
      - **Сделано** Проверять и выводить предупреждение если роли не удалены
      - **Сделано** Удалять роли перед сохранением новых
      - **Сделано** Список-таблица валидаторов с поиском по адресу
    - **Сделано** Добавить в locale мультиязычности все фразы по новому функционалу
    - **Сделано** В админке выводить и задавать цену за газ для залога при submit
    - **Сделано** В админке выводить и задавать долю GaltSpace
    - **Сделано** В админке выводить и задавать метод оплаты заявок
    - **Сделано** На странице создании заявки - давать возможность оплачивать только той валютой, которая указана в методе оплаты контракта
  - Исправить логику закрытия модального окна с встроенным кошельком(при закрытии отправляются транзанкции через МетаМаск)
  - Добавить дополнительную информацию об RPC серверах с возможностью задания через locale
  
  - Кран ETH: Пункт в меню со страничкой, где пользователь раз в 5 минут может получить 100 ETH
    - Верстка страницы Кран ETH, 60 мин
    - Использование приватника майнера в браузере для отправки транзакции с ETH на адрес пользователя, 60 мин
    - Блокирование по времени: получать эфирки можно только раз в 5 минут, в остальное время кнопка не активна, 60 мин
    
  - Вывод ошибок в логи в случае провала транзанкции
      - Анализ данных транзанкции, внутреннего кошелька и статуса сервера, 240 мин
      
  - Внедрить простейшую версионность: 
    - Выводить в интерфейсе версию приложения возле надписи Galt Project Global Land Registry
    - Записывать список изменений для каждой версии
    - При нажатии на номер версии - выводить в модальном окне историю изменений с прошлыми версиями

  - Поиск по карте(по странам, городам и адресам)
  - Поиск по геохешам в Мои участки
  - При создании заявки - проверять что апроксимированные геохеши не принадлежат ни кому. Если принадлежат - подсвечивать и предупреждать пользователя с блокировкой кнопки создания заявки
  - После создания заявки - блокировать инпуты для изменения границ участка, чтобы пользователь мог добавить геохеши только в уже зафиксированные границы участка
  - Рядом с транзанкциями показывать сколько на них затрачено газа и эфиров
  
  - Оформить билд скрипты для продакшена
    - Минимизация
    - Обфускация
    - Динамическое имя сбилденного скрипта для избежания проблемы кеширования у пользователя
    - Автоудаление неиспользуемого кода из билда
    
  - Переделать логику по вводу координат: оставлять координаты в инпуте, но строить контур по геохешам
  - Убрать слово "Упаковка" из интерфейса и заменить на "Земельный участок"
  - Перезагружать интерфейс при измененении кошелька в MetaMask
  - GaltDex: На кнопке Отправить транзанкцию - дополнительно показывать количество транзанкций, которое ему надо будет отправить для обмена(для обмена Galt на ETH нужно две транзакции: approve и transfer)
  - Перестраивать контур для апроксимации геохешей по часовой или против часовой стрелке если пользователь указал вершины в произвольном порядке
  - При проверке геохешей упаковки - если есть недостающие геохеши: показать их на карте в окне предупреждения выделив цветом среди других геохешей упаковки, 60 мин
  - Поставить ограничение на максимальный размер геохеша для регистрирования территории чтобы избежать злоупотребления, 30 мин
  - В интерфейсе проверять площадь указанного пользователем контура и предупреждать в соответствии с площадью - какую точность он может указать, а какая приведет к долгим расчетам., 90 мин
  
  - Возможность сбросить валидатора владельцем контракта
    - Страница со всеми заявками в статусе закреплена
    - Сброс залоченного валидатора владельцем контракта
    
  - Дополнительно добавление и удаление геохешей с помощью выделения контуром, со оставлением списка геохешей в инпуте как доп фичи
  - Ловить [Онлайн и Офлайн](https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/Online_and_offline_events) ивенты для того чтобы блокировать экран и приостанавливать очередь транзанкций 
  - Написать тест который проверяет что набор разных локалей(ru и en) сходится, и если нет - выводить список тех, которые отсутствуют в указанной локали
  
## Backlog Контракты
  - В PlotManager при добавлении геохешей после возврата заявки - добавлять газ к залогу
  - **Женя: Сделано** В PlotManager дать возможность назначать операторов для валидаторов, чтобы оператор валидатора мог разобрать заявку
  - **Женя: Сделано** В Validators сделать роли ValidatorManager и RolesManager для делегирования прав на управление валидаторами и ролями
  - Добавить обработку/проверку addGeohashToPackage Что геохеш хотя бы имеет 1 соседа по указанной стороне, и они входят в упаковку


# Sprint 6
## SplitMerge
- Добавить обработку/проверку addGeohashToPackage
  - Что геохеш входит в контур упаковки, границы которой заданы многоугольником из прямых линий
    - Разработать стандарт для указания контура
      - Тип сегмента(прямая линия, точка, кривая линия)
      - Доп информация(угол)
    - При сохранении контура - определять углы между линиями и так-же сохранять их
    - При сохранении контура - конвертировать геохеши в координаты и также сохранять их
    - Функция для определения того, что две прямые пересекаются
    - Функция определения того, что точка находится в пределах контура
    - Функция определения того, что геохеш со своими краями-точками находится в пределах контура
      - Перебор краёв геохеша с определением его координат
      - Построение 4-х произвольных прямых из краёв геохеша для определения пересечения с прямой контура
      - Перебор прямых контура с определением для каждой: пересекаются ли прямые выходящие из вершин геохеша с каждой из прямой
    - Написать тесты
    
