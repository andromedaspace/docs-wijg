# Smart Space контракты

* Epic issue https://github.com/andromedaspace/WIJG/issues/358
* UI Mindmap https://www.mindmeister.com/1116736851

Как аренда земли, так и совместная собственность подразумевают хранение токена на смарт контракте. Для обобщения, введен специальный термин Smart Space.

Контракты SmartSpace взаимодейстуют только с контрактами репутации фондов. Они имеют право распределять репутацию между не ограниченным (теоритически) количеством пользователей, вызывая соответствующий метод контракта репутации. Сумма репутаций всех участников конракта Smart Space не может превышать кол-во заложенных за токен GALT (репутацию токена).

Нашей комндой будут разработаны базовые контракты аренды и совместной собственности Space токенов. Если предоставленного функционала будет мало, любой участник сможет самостоятельно дополнить функционал контракта. Например, такие как:

* Whitelist/blacklist
* Гарантийный депозит
* Стартовая комиссия
* Условия для досрочного прекращения контракта

## Контракты, предоставляемые нашей командой
### Контракт аренды SpaceRentalBasic

#### Общие тезисы

* Единицей измерения срока аренды в предлагаемом нами контракте является `период`.
* Период задается в секундах.

#### Создание контракта

* При деплое (создании) контракта аренды владелец контракта указывает следующие данные (в конструкторе):
  * Величину одного периода в секундах. Например, 30 * 24 * 60 * 60 секунд за 1 период.
  * Размер ставки за один период и 100% репутации в нем. Например, 250 GALT за 100% репутации на 1 период.
  * Кол-во будущих периодов, доступных для вступления арендаторами. Например, 5 - это значит, пользователь может уже внести арендную плату на 5 периодов (по 30 дней каждый) вперед, не включая текущий. На каждый период отдельная транзакция.
* По умолчанию минимальный депозит за 1 период составляет 1 GALT. Может быть изменен отдельной транзакцией.
* Перечислить токен на контракт аренды может только создатель контракта, при попытке перевода с других адресов, транзакция будет отклоняться.
* При попытке перечислить второй токен на контракт, транзакция будет отклоняться.
* После перевода токена вся репутация переводится владельцу контракта. Об этом контракт аренды явно уведомляет контракт репутации.

#### Изменение
##### Владелец может:

* Закрыть контракт и вывести space токен, если ни на данный момент нет ни одного активного арендатора.
* Приостановить вступление новых арендаторов. 
* Приостановить возможность продления для текущих арендаторов.
* Изменить ставку ТОЛЬКО при отсутствии активных арендаторов.
* Изменить минимальный срок аренды для новых арендаторов.
* Изменить максимальный срок аренды для новых арендаторов.

##### Владелец ОБЯЗАН!!!:

* В начале каждого периода отзывать репутацию пользователей из предыдущего периода отдельной транзакцией.

##### Арендатор может:

* Продлить аренду, внеся оплату за будущие периоды, если в них еще есть место.
* Увеличивать уже оплаченную долю в текущем и последующих периодах, если есть еще место.

##### Арендатор НЕ может:
* Отозвать уже оплаченную аренду за любой период.

#### Репутация

Изменения долей аренды отражаются в следующих контрактах:

- локальная репутация (изменяется репутация адреса)
- глоальная репутация (изменяется репутация адреса)
- голосование (пока нет понимания, как это может работать в рамках solidity)

#### Математика
##### Рассчет репутации

R = floor(Tr * Ud / Rp)
  * R - арендуемая репутация пользователя в данные период (в GALT)
  * Tr - репутация токена (в GALT)
  * Ud - арендный депозит пользователя за данный период (в GALT)
  * Rp - ставка за 100% аренды на 1 период

Например:
* Space токен имеет репутацию 1500 GALT
* Ставка за 100% равна 250 GALT
* Уплаченная пользователем аренда 60 GALT

Это означает, что:
* R = floor(1500 * 63,53 / 250)
* R = floor(1500 * 0,25412)
* R = floor(381,18)
* R = 381

Пользователь получает 381 GALT репутации на арендуемый период.

### Контракт совместной собстенности
#### Тезисы

* Отсутствует ограничение на кол-во участников
* Для контакта совместной собственности все дальнейшие действия с токеном, включая его отзыв, будут определятся мультисигом с голосованием. Исполняться будет только при явном 100% согласии всех участников. Вариант мастера отклоняем.
* При разделе репутации округление производится в меньшую сторону. Округляются не проценты, а доли залоговой стоимости.
    * Пример 1. Участком владеет 3 собственника и залоговая стоимость участка 100 GALT, у каждого из них будет по 33 GALT репутации + 1 GALT репутации будет принадлежать владельцу контракта.
    * Пример 2. Участком владеет 4 собственника и залоговая стоимость участка 321 GALT, у каждого из них будет по 80 GALT репутации + 1 GALT у собственника контракта.
* Возможно ограничение на минимальный взнос (по умолчанию отсутствует). Примеры:
    * Участок с залоговой стоимостью 100 GALT, мин взнос 10%
        * 0 участников - 100% репутации => владельцу контракта
        * 1 участник вносит 20 GALT; собственник => 80%, 1й участник => 20%
        * 2 участник вносит 50 GALT; собственник => 30%, 1й участник => 20%, 2й участник => 50%;
        * 3 участник вносит 30%; собственник => 0%, 1й участник => 20%, 2й участник => 50%; 3й участник => 30%; Идея в том, что, пока 100% репутации не распределено, остаток репутации отдается собственнику; но если все 100% разберут арендаторы, то у собственника не останется репутации)
